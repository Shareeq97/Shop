<table>
  <tbody>
    <tr>
      <td><strong>Feature Ticket Id :</strong></td>
      <td> <%= feature.ticket_id %></td>
    </tr>
    <tr>
      <td><strong>Feature Name :</strong></td> 
      <td><%= feature.feature_name %></td>
    </tr>
    <tr>
      <td><strong>Category :</strong></td>
      <td><%= feature.category_name %></td>
    </tr>
    <tr>
      <td colspan="2"><strong>Feature Description :</strong>
    </tr>
    <tr>
      <td colspan="2"><p class="feature-desc"><%= feature.feature_description %></p></td>
    </tr>
    <tr>
      <td><%= button_to 'Delete', user_project_feature_path(feature.project.user_id, feature.project_id, feature.id), method: :delete, data: { confirm: 'Are you sure?' } %>
      </td>
    </tr>
    <tr>
      <td><strong>Feature Status:</strong></td>
      <td><%= select "feature_status", "#{ feature.id }", options_for_select([["Unstarted", "Unstarted"], ["Started", "Started"], ["Finished", "Finished"], ["Delivered", "Delivered"]], selected: feature.feature_status) %>
      </td>
    </tr>
    <tr>
      <td><strong>Assign to:</strong></td>
      <td><%= select("feature", "#{ feature.id }", User.all.collect { |user| [user.email, user.id] }, { prompt: "Select One", selected: feature.user_id, onchange: "update_member(this.value)" }) %>
      </td>
    </tr>
  </tbody>
</table>
<br>
<% if feature.documents.empty? %>
  <div>
    <%= render partial: "documents/form", locals: { feature: feature } %>
  </div>
<% else %>
  <div>
    <%= render partial: "documents/list_document", locals: { feature: feature } %>
  </div>
<% end %>
<br>
<div>
  <%= render partial: "tasks/list_tasks", locals: { feature: feature } %>
</div>
<br>
<div>
  <%= render partial: "tasks/form", locals: { feature: feature } %>
</div>
<br>
<div class="comment-section">
  <div>
    <%= render partial: "comments/comment_list", locals: { feature: feature } %>
  </div>
  <br>
  <div>
    <%= render partial: "comments/form", locals: { feature: feature } %>
  </div>
</div>

<script>
  $(document).ready(function(){
    $('#feature_<%= feature.id %>').select2();

    $("#feature_<%= feature.id %>").change(function(){
      jQuery.ajax({
        url: "/features/<%= feature.id %>",
        beforeSend: function(xhr) { xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content')) },
        type: "PATCH",
         data: { "member_id": this.value },
          success: function(data) {
            alert("Member successfully assigned.");
          }
      });
    });

    $("#feature_status_<%= feature.id %>").bind('change',function(){
      jQuery.ajax({
        url: "/features/<%= feature.id %>/update_status",
        beforeSend: function(xhr) { xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content')) },
        type: "PATCH",
        data: { "feature_status": this.value },
        success: function(data) {
          alert("Status successfully set.");
        }
      });
    });
  });
</script>
